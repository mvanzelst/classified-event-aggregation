package org.classified_event_aggregation.storm_input_topology.storm;

import java.nio.charset.Charset;
import java.util.List;
import java.util.Random;

import org.apache.commons.lang.RandomStringUtils;

import storm.trident.testing.FixedBatchSpout;
import backtype.storm.tuple.Fields;
import backtype.storm.tuple.Values;

public class TestSpoutFactory {

	private static Long time = System.currentTimeMillis();
	
	@SuppressWarnings("unchecked")
	public static FixedBatchSpout build() {
		FixedBatchSpout spout = new FixedBatchSpout(
			new Fields("bytes"), 
			10, 
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue(),
			getValue()
		);
		spout.setCycle(true);
		return spout;
	}
	
	@SuppressWarnings("unchecked")
	private static List<Object> getValue(){
		return new Values(
			("{description: '" + RandomStringUtils.randomAlphanumeric(100) + "', timestamp: " + getIncrementingTimestamp() + ", classifications: '" + getRandomClassifications(3) + "'}")
				.replace("'", "\"")
				.getBytes(Charset.forName("UTF-8"))
		);
	}
	
	private static Long getIncrementingTimestamp(){
		time += 10000000L;
		return time;
	}
	
	
	private static String getRandomClassifications(int number){
		StringBuilder sb = new StringBuilder();
		for (int i = 0; i < number; i++) {
			 String[] classifications = new String[]{
				"LogLevel:Error",
				"LogLevel:Warn",
				"LogLevel:Debug",
				"User:1",
				"User:2"
			};

			sb.append(randomFromArray(classifications));
			if(i+1<number){ // No the last iteration
				sb.append(" ");
			}
		}
		return sb.toString();
	}
	
	private static String randomFromArray(String[] array){
		return array[new Random().nextInt(array.length)];
	}
}
